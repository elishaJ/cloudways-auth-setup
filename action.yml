name: 'Cloudways SSH Authentication'
description: 'Github action to setup SSH key to perform task via SSH session'
inputs:
  email:
    description: 'Cloudways account email'
    required: true
  api_key:
    description: 'Cloudways API key'
    required: true
  app_id:
    description: 'Cloudways app ID'
    required: true
  server_id:
    description: 'Cloudways server ID'
    required: true
outputs:
  task-id:
    description: "Task ID generated by /auth endpoint"
    value: ${{ steps.auth-setup.outputs.task-id }}
  
  master-user:
    description: "Cloudways server Master User"
    value: ${{ steps.auth-setup.outputs.master-user }}
  
  sys-user:
    description: "Application folder name on Cloudways"
    value: ${{ steps.auth-setup.outputs.sys-user }}

  server-ip:
    description: "Cloudways server public IP"
    value: ${{ steps.auth-setup.outputs.server-ip }}

  key-path:
    description: "SSH key path for key based authenticaion"
    value: ${{ steps.auth-setup.outputs.key-path }}

runs:
  using: "composite"
  steps:
    - name: Set GitHub Path
      run: echo "$GITHUB_ACTION_PATH" >> $GITHUB_PATH
      shell: bash
      env:
        GITHUB_ACTION_PATH: ${{ github.action_path }}
    
    - name: Run auth_setup.sh
      id: auth-setup
      continue-on-error: false
      run: auth_setup.sh
      shell: bash
      env:
        EMAIL: ${{ inputs.email }}
        API_KEY: ${{ inputs.api_key }}
        APP_ID: ${{ inputs.app_id }}
        SERVER_ID: ${{ inputs.server_id }}
